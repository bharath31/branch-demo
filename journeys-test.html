<!DOCTYPE html>
<html>
<head>
    <div class="branch-journeys-top"></div>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="branch:deeplink:$ios_deeplink_path" content="shop/12345"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

    <script>
        // load Branch
        (function (b, r, a, n, c, h, _, s, d, k) {
            if (!b[n] || !b[n]._q) {
                for (; s < _.length;) c(h, _[s++]);
                d = r.createElement(a);
                d.async = 1;
                d.src = "https://cdn.branch.io/branch-latest.min.js";
                k = r.getElementsByTagName(a)[0];
                k.parentNode.insertBefore(d, k);
                b[n] = h
            }
        })(window, document, "script", "branch", function (b, r) {
            b[r] = function () {
                b._q.push([r, arguments])
            }
        }, {
            _q: [],
            _v: 1
        }, "addListener applyCode autoAppIndex banner closeBanner closeJourney creditHistory credits data deepview deepviewCta first getCode init link logout redeem referrals removeListener sendSMS setBranchViewData setIdentity track validateCode trackCommerceEvent".split(" "), 0);
        // init Branch
        branch.init('key_test_lkgYPVDLW7NOfVdflieB3hdptDnQVdaN', {auto_open: true});
    </script>

</head>
<body>
<script type="text/javascript">
    function launchJourneys() {
        var linkData = {
            channel: 'facebook',
            feature: 'dashboard',
            stage: 'new user',
            tags: ['tag1', 'tag2', 'tag3'],
            alias: '',
            data: {
                'custom_bool': true,
                'custom_int': Date.now(),
                'custom_string': 'hello',
                '$og_title': 'Title',
                '$uri_redirect_mode': 2,
                '$og_image_url': 'http://lorempixel.com/400/400',
                '$ios_deeplink_path': 'shop/1234123125'
            }
        };
        //branch.setBranchViewData(linkData);
    }

    var listener = function (event, data) {

        if (event == "willCloseJourney") {
            str = JSON.stringify(data, null, 2);

            //get link URL from the Journey data set in the Branch dashboard
            //var qwe = data.journey_link_data.data.my_data;

            //create a new Branch link using the link above
            //     var linkData = {
            //         campaign: data.journey_link_data.campaign,
            //         feature: data.journey_link_data.feature,
            //         stage: 'new user',
            //         tags: ['tag1', 'tag2', 'tag3'],
            //         alias: '',
            //         data: {
            //             'custom_bool': true,
            //             'custom_int': Date.now(),
            //             'custom_string': 'hello',
            //             '$og_title': 'Title',
            //             '$og_description': 'Description',
            //             '$og_image_url': 'http://lorempixel.com/400/400',
            //             '$ios_deeplink_path': data.journey_link_data.data.$ios_deeplink_path,
            //             'my_data':data.journey_link_data.data.my_data,
            //             '$ios_url':qwe,
            //             '$android_url':qwe,
            //             '$desktop_url':qwe,
            //             '$fallback_url':qwe
            // }
            //     };
            //
            //     branch.link(linkData, function (err, link) {
            //         console.log(link);
            //     });


            //var qqe = 'https://branchster.app.link/?'+ encodeURI('$fallback_url='+qwe+'&$web_only=true&campaign=branchApsalar&feature=Journeys');
            //$(location).attr('href', qqe)
        }
    }

    // custom domain works


    // Specify an event to listen for
    branch.addListener('willCloseJourney', listener);
    // Listen for all events
    branch.addListener(listener);


</script>

</body>
</html>
